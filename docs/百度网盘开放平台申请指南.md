# 百度网盘开放平台应用申请指南

## 目录
1. 注册/登录百度账号
2. 创建应用
3. 获取密钥
4. 配置回调地址
5. 测试授权流程

---

## 第一步：注册/登录百度账号

### 1.1 访问百度网盘开放平台

打开浏览器，访问：
- **网址**：https://pan.baidu.com/union/doc/0ksg0sbig

或者搜索：
- 搜索关键词："百度网盘开放平台"
- 点击第一个结果

### 1.2 登录百度账号

- 如果已有百度账号：直接点击右上角"登录"
- 如果没有百度账号：点击"注册"创建新账号

**重要提示**：
- 这个百度账号是作为"开发者账号"
- 与用户授权的百度网盘账号是**两回事**
- 您的百度账号 = 开发者（创建应用的人）
- 用户的百度账号 = 普通用户（使用应用的人）

---

## 第二步：创建应用

### 2.1 进入控制台

登录后会看到开放平台首页，点击：
- 右上角头像 → "控制台"
- 或者直接访问：https://pan.baidu.com/union/console

### 2.2 点击"创建应用"

在控制台页面：
1. 找到"应用管理"或"我的应用"
2. 点击"创建应用"或"+新建应用"按钮

### 2.3 填写应用信息

会弹出创建应用表单，填写以下信息：

#### 基本信息

| 字段 | 填写内容 | 说明 |
|------|---------|------|
| **应用名称** | 今天吃什么 | 您的APP名称，中文即可 |
| **应用类型** | 移动应用 | 选择"移动应用" |
| **应用简介** | 一款帮助朋友、情侣决定"今天吃什么"的应用，支持将照片备份到百度网盘 | 简要描述您的应用功能 |
| **应用图标** | 上传APP图标 | 上传您的APP图标（可选，可先跳过） |

#### 选择权限

在"应用权限"或"申请能力"部分：
- 勾选 **"网盘文件读写"** 或类似选项
- 权限名称通常是：`netdisk` 或 `文件读写`

**重要**：
- 只需要申请**文件读写**权限即可
- 不需要申请其他高级权限
- 这些都是**免费的**

#### 联系方式（可选）

- 邮箱：您的邮箱地址
- 手机号：您的手机号（可选，可先跳过）

### 2.4 提交审核

点击"提交"或"创建"按钮。

**重要提示**：
- 个人应用的审核通常是**自动通过**的
- 审核时间：几分钟到24小时不等
- 很多情况下**立即通过**

---

## 第三步：获取密钥

### 3.1 查看应用详情

应用创建成功后：
1. 在"我的应用"列表中找到刚创建的"今天吃什么"
2. 点击应用名称进入详情页

### 3.2 复制APP KEY和SECRET KEY

在应用详情页会看到：

```
应用基本信息：
应用ID（APP KEY）：2501234567
密钥（SECRET KEY）：abcd1234secret5678
应用名称：今天吃什么
应用类型：移动应用
```

**操作步骤**：
1. 找到 **"APP KEY"** 或 **"应用ID"**
2. 点击旁边的"复制"按钮
3. 粘贴到记事本，格式如下：

```text
APP KEY: 2501234567
SECRET KEY: abcd1234secret5678
```

**安全提示**：
- ✅ APP KEY可以公开，不怕泄露
- ❌ SECRET KEY必须保密，只能存在服务器上
- ❌ 不要把SECRET KEY写到前端代码（Android/JS等）

---

## 第四步：配置回调地址

### 4.1 添加OAuth设置

在应用详情页找到：
- "授权设置"
- 或"OAuth设置"
- 或"回调地址"

### 4.2 填写回调URL

在"授权回调地址"或"Redirect URI"字段中填写：

```
http://api.jamesweb.org:8883/api/baidu/oauth/callback
```

**说明**：
- 这是百度授权后要跳转回的地址
- 必须是HTTP/HTTPS开头的完整URL
- 必须是您服务器能访问的地址

### 4.3 保存配置

点击"保存"或"添加"按钮。

---

## 第五步：配置到项目

### 5.1 修改application.yml

打开文件：`springboot-backend/src/main/resources/application.yml`

找到百度网盘配置部分：

```yaml
# 百度网盘配置
baidu:
  drive:
    app-key: ${BAIDU_APP_KEY:your-app-key}
    secret-key: ${BAIDU_SECRET_KEY:your-secret-key}
    redirect-uri: http://api.jamesweb.org:8883/api/baidu/oauth/callback
    upload-api: https://pan.baidu.com/rest/2.0/xpan/file
    authorize-url: https://openapi.baidu.com/oauth/2.0/authorize
    token-url: https://openapi.baidu.com/oauth/2.0/token
```

将您申请到的密钥替换进去：

```yaml
# 百度网盘配置
baidu:
  drive:
    app-key: 2501234567  # 替换成您的APP KEY
    secret-key: abcd1234secret5678  # 替换成您的SECRET KEY
    redirect-uri: http://api.jamesweb.org:8883/api/baidu/oauth/callback
    upload-api: https://pan.baidu.com/rest/2.0/xpan/file
    authorize-url: https://openapi.baidu.com/oauth/2.0/authorize
    token-url: https://openapi.baidu.com/oauth/2.0/token
```

### 5.2 提交修改

```bash
git add springboot-backend/src/main/resources/application.yml
git commit -m "config: 配置百度网盘APP KEY和SECRET KEY"
```

---

## 第六步：部署并测试

### 6.1 编译后端

```bash
cd springboot-backend
"C:\Program Files\JetBrains\IntelliJ IDEA 2025.2.5\plugins\maven\lib\maven3\bin\mvn.cmd" clean package -DskipTests
```

### 6.2 部署到服务器

```bash
scp springboot-backend/target/what2eat-backend-1.0.0.jar root@47.83.126.42:/root/what2eat/target/
ssh root@47.83.126.42 "cd /root/what2eat && docker compose restart app"
sleep 8
```

### 6.3 编译Android

```bash
cd android-app
./gradlew.bat assembleDebug
```

### 6.4 安装APK

```bash
adb install android-app/app/build/outputs/apk/debug/app-debug.apk
```

### 6.5 测试授权流程

1. 打开"今天吃什么"APP
2. 登录（testuser1 / 123456）
3. 进入"我的相册"
4. 点击"授权百度网盘"按钮
5. 会打开WebView显示百度登录页面
6. 输入您的百度账号密码
7. 点击"同意授权"
8. 授权成功后会自动返回APP
9. 后端数据库会保存您的Token

---

## 常见问题

### Q1: 创建应用时提示需要企业认证怎么办？

**A**: 选择"个人应用"类型即可，不需要企业认证。如果找不到个人应用选项，说明百度可能更新了政策，此时：

- 可以先用公司信息创建（如果有的话）
- 或者选择"移动应用"类型通常就可以
- 个人开发者的应用都是免费的

### Q2: 审核需要多久？

**A**:
- 个人应用通常是**自动审核**或**快速审核**
- 一般几分钟到几小时
- 最长不超过24小时

### Q3: 如何知道审核通过了？

**A**:
- 登录控制台查看应用状态
- 如果状态显示"已上线"或"正常"即可
- 有些平台会发邮件通知

### Q4: 回调地址必须填写吗？

**A**:
- **是的，必须填写**
- 而且必须填写正确的服务器地址
- 因为授权后需要跳转回这个地址
- 我们的后端已经实现了这个回调接口

### Q5: 可以用内网地址或localhost作为回调地址吗？

**A**:
- **不可以**
- 百度服务器必须能访问到这个地址
- 必须是公网地址（您的服务器：http://api.jamesweb.org:8883）
- 测试时可以先填，但正式授权时必须是真实地址

### Q6: APP KEY和SECRET KEY泄露了怎么办？

**A**:
- **APP KEY泄露**：问题不大，可以继续使用
- **SECRET KEY泄露**：
  1. 立即登录百度网盘控制台
  2. 找到您的应用
  3. 点击"重置密钥"或"重新生成"
  4. 用新的SECRET KEY替换application.yml中的旧密钥
  5. 重新部署后端

### Q7: 可以创建多个应用吗？

**A**:
- **可以**
- 但一个APP KEY足够了
- 多个用户用同一个APP KEY授权，每个用户有独立的Token
- 就像"微信登录"：一个微信开放平台账号可以服务无数个APP用户

---

## 测试账号说明

**您自己测试时**：
- 1个APP KEY（您申请的）
- 您的百度账号A → 授权 → Token A
- 您的百度账号B → 授权 → Token B

**实际用户使用时**：
- 同样是1个APP KEY（您的）
- 用户A的百度账号 → 授权 → 用户A的Token
- 用户B的百度账号 → 授权 → 用户B的Token
- 用户C的百度账号 → 授权 → 用户C的Token

---

## 下一步

申请完成后：
1. 把APP KEY和SECRET KEY告诉我，我帮您配置到项目
2. 部署后端并测试
3. 完成剩余的批量同步功能

**准备好申请了吗？有任何疑问随时问我！**
