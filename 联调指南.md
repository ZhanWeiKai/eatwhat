# 今天吃什么 - 联调指南

## 📋 环境检查清单

### 1. 数据库 ✅ 已完成
- **数据库名称**: `what2eat`
- **端口**: 3306
- **用户名**: root
- **密码**: 123456
- **状态**: 已创建并初始化测试数据

**测试账号**：
| 用户名 | 密码 | 昵称 |
|--------|------|------|
| testuser1 | 123456 | 测试用户1 |
| testuser2 | 123456 | 测试用户2 |
| testuser3 | 123456 | 测试用户3 |

**测试数据**：
- ✅ 3个用户
- ✅ 10个菜品（热菜、凉菜、主食、汤品）
- ✅ 2条推送记录

---

## 🚀 启动后端服务

### 方法1：使用启动脚本（推荐）

**Windows**：
```batch
# 双击运行
C:\claude-project\eatwhat\start-backend.bat
```

### 方法2：使用Maven命令

```bash
# 进入后端目录
cd C:\claude-project\eatwhat\springboot-backend

# 启动服务
mvn spring-boot:run
```

### 方法3：在IDE中运行

**IDEA**：
1. 打开 `springboot-backend` 目录
2. 找到 `src/main/java/com/what2eat/What2EatApplication.java`
3. 右键 → Run 'What2EatApplication'

**Eclipse**：
1. 导入项目为Maven项目
2. 运行 `What2EatApplication.java`

---

## ✅ 后端启动成功标志

看到以下日志表示启动成功：

```
  ____                    _           _ ____
 / ___| _   _  ___  ___| |__   ___ |  _ \ \
 \___ \| | | |/ _ \/ __| '_ \ / _ \| | | | |
  ___) | |_| | (_) \__ \ | | | (_) | |_| | |
 |____/ \__, |\___/___/_| |_|\___/|____/_|
        |___/

Started What2EatApplication in X.XXX seconds (JVM running for X.XXX)
Tomcat started on port(s): 8883 (http) with context path '/api'
```

**验证后端**：
- 浏览器访问：http://10.88.1.127:8883/api/
- API文档：http://10.88.1.127:8883/api/swagger-ui.html

---

## 📱 安装Android应用

### 步骤1：重新编译（确保使用最新配置）

```bash
cd C:\claude-project\eatwhat\android-app

# 清理并重新编译
.\gradlew.bat clean assembleDebug
```

**编译成功标志**：
```
BUILD SUCCESSFUL in Xs
```

APK位置：`android-app\app\build\outputs\apk\debug\app-debug.apk`

### 步骤2：安装到Android设备

**方法1：使用adb**
```bash
# 连接设备
adb devices

# 安装APK
adb install app\build\outputs\apk\debug\app-debug.apk

# 如果已安装，覆盖安装
adb install -r app\build\outputs\apk\debug\app-debug.apk
```

**方法2：直接复制**
1. 将 `app-debug.apk` 复制到手机
2. 在手机上点击安装
3. 允许安装未知来源应用（设置中开启）

### 步骤3：Android Studio运行
1. 打开 `android-app` 目录
2. 连接Android设备
3. 点击 Run 按钮（绿色三角形）

---

## 🧪 完整测试流程

### 1. 注册/登录测试

**测试步骤**：
1. 打开应用 "今天吃什么"
2. 输入用户名: `testuser1`
3. 输入密码: `123456`
4. 点击"登录"按钮

**预期结果**：
- ✅ 登录成功
- ✅ 跳转到主页
- ✅ 显示"你好，测试用户1"

### 2. 点菜功能测试

**测试步骤**：
1. 点击"开始点菜"
2. 查看菜品列表（应该显示10个测试菜品）
3. 点击分类"凉菜"，查看菜品切换
4. 点击"宫保鸡丁"的"+"按钮
5. 查看底部购物车：显示"共1件 ¥38"
6. 继续添加"麻婆豆腐"
7. 点击底部购物车栏
8. 查看购物车展开面板
9. 调整数量或删除菜品
10. 点击"推送菜单"按钮

**预期结果**：
- ✅ 菜品列表正常显示
- ✅ 分类切换正常
- ✅ 购物车实时更新
- ✅ 购物车展开/收起正常
- ✅ 推送成功提示
- ✅ 跳转到推送列表页面

### 3. 推送列表测试

**测试步骤**：
1. 在推送列表页面查看记录
2. 检查是否显示自己的推送（有删除按钮）
3. 点击"删除"按钮
4. 确认删除

**预期结果**：
- ✅ 推送记录正常显示
- ✅ 只有自己的推送显示删除按钮
- ✅ 删除成功，列表刷新

### 4. 多用户测试（可选）

**测试步骤**：
1. 退出登录
2. 使用 `testuser2` 登录
3. 查看推送列表（应该能看到 testuser1 的推送）
4. 验证无法删除 testuser1 的推送

---

## 🔧 配置信息

### Android网络配置
```kotlin
BASE_URL: "http://10.88.1.127:8883/api/"
WS_URL: "ws://10.88.1.127:8883/api/ws"
```

### 后端配置
```yaml
server:
  port: 8883
  context-path: /api

spring:
  datasource:
    url: jdbc:mysql://localhost:3306/what2eat
    username: root
    password: 123456
```

---

## 🐛 常见问题排查

### 问题1：Android无法连接后端

**检查步骤**：
1. 后端是否启动？访问 http://10.88.1.127:8883/api/
2. 手机和电脑是否在同一WiFi？
3. 防火墙是否允许8883端口？
4. BASE_URL配置是否正确？

**解决方法**：
```bash
# Windows防火墙 - 添加8883端口入站规则
# 控制面板 → Windows Defender 防火墙 → 高级设置 → 入站规则 → 新建规则
# 端口：8883，协议：TCP，操作：允许连接
```

### 问题2：后端启动失败

**检查步骤**：
1. Java是否安装？`java -version`
2. MySQL是否运行？`mysql -u root -p123456 -e "SELECT 1"`
3. 端口8883是否被占用？`netstat -ano | findstr "8883"`

**解决方法**：
```bash
# 查看占用8883端口的进程
netstat -ano | findstr "8883"

# 结束进程（如果需要）
taskkill /F /PID <进程ID>
```

### 问题3：数据库连接失败

**检查步骤**：
1. MySQL服务是否启动？
2. 数据库 `what2eat` 是否存在？
3. 密码是否正确（123456）？

**解决方法**：
```bash
# 重启MySQL服务
net stop MySQL
net start MySQL

# 或者在服务管理器中重启MySQL服务
```

---

## 📊 API接口列表

### 认证接口
- POST `/api/auth/register` - 注册
- POST `/api/auth/login` - 登录
- GET `/api/auth/me` - 获取当前用户

### 菜品接口
- GET `/api/dishes` - 获取所有菜品
- GET `/api/dishes/category/{category}` - 按分类获取菜品
- POST `/api/dishes` - 上传菜品

### 推送接口
- GET `/api/push/list` - 获取推送列表
- POST `/api/push` - 创建推送
- DELETE `/api/push/{id}` - 删除推送

### 好友接口
- GET `/api/friends` - 获取好友列表
- POST `/api/friends/add` - 添加好友

---

## 📞 技术支持

如有问题，请检查：
1. 后端日志：控制台输出
2. Android日志：`adb logcat` 或 Android Studio Logcat
3. 数据库状态：MySQL Workbench

**祝测试顺利！** 🎉
