# Android-Backend 集成测试指南

## ✅ 准备工作检查

### 1. 后端服务状态
- ✅ 在IDEA中运行 `What2EatApplication.java`
- ✅ 看到启动日志：`Started What2EatApplication` 和 `Tomcat started on port(s): 8883`
- ✅ 后端地址：http://10.88.1.127:8883/api/

### 2. 数据库状态
- ✅ MySQL服务运行中
- ✅ 数据库 `what2eat` 已创建
- ✅ 测试数据已插入：3用户 + 10菜品 + 2推送

### 3. Android应用
- ✅ APK位置：`android-app/app/build/outputs/apk/debug/app-debug.apk`
- ✅ BASE_URL配置：`10.88.1.127:8883`

---

## 📱 测试步骤

### 步骤1：安装Android应用

**方法1：使用ADB**
```bash
# 连接手机
adb devices

# 安装APK
adb install -r C:\claude-project\eatwhat\android-app\app\build\outputs\apk\debug\app-debug.apk
```

**方法2：直接安装**
1. 将 `app-debug.apk` 复制到手机
2. 在手机上点击安装
3. 允许安装未知来源应用（设置中开启）

---

### 步骤2：登录测试

1. 打开应用 "今天吃什么"
2. 输入测试账号：
   - **用户名**: `testuser1`
   - **密码**: `123456`
3. 点击"登录"

**预期结果**：
- ✅ 登录成功
- ✅ 跳转到主页
- ✅ 显示"你好，测试用户1"
- ✅ 显示6个功能入口

---

### 步骤3：点菜功能测试

1. 点击"开始点菜"按钮
2. 查看菜品列表（应该显示10个菜品）
3. 测试分类切换：
   - 点击"热菜" → 查看菜品
   - 点击"凉菜" → 查看菜品
   - 点击"主食" → 查看菜品

4. 添加菜品到购物车：
   - 点击"宫保鸡丁"的"+"按钮
   - 查看底部购物车：显示"共1件 ¥38"
   - 继续添加"麻婆豆腐"
   - 查看底部购物车：显示"共2件 ¥66"

5. 查看购物车：
   - 点击底部购物车栏
   - 查看购物车展开面板
   - 测试数量调整：点击"+"或"-"
   - 测试删除：点击"删除"按钮

6. 推送菜单：
   - 点击"推送菜单"按钮
   - 等待推送成功提示
   - 自动跳转到推送列表页面

**预期结果**：
- ✅ 菜品列表正常显示（包括图片、名称、价格）
- ✅ 分类切换流畅
- ✅ 购物车实时更新
- ✅ 推送成功提示
- ✅ 跳转到推送列表

---

### 步骤4：推送列表测试

1. 查看推送列表
2. 检查是否显示：
   - 推送者头像和昵称
   - 菜品详情（图片、名称、数量、价格）
   - 总金额
   - 删除按钮（仅自己的推送显示）

3. 测试删除功能：
   - 点击刚才推送的记录的"删除"按钮
   - 确认删除
   - 查看列表刷新

**预期结果**：
- ✅ 推送记录正常显示
- ✅ 自己的推送有删除按钮
- ✅ 删除成功，列表刷新

---

### 步骤5：多用户测试（可选）

1. 退出登录（主页点击"退出"）
2. 使用 `testuser2` 登录（密码：123456）
3. 查看推送列表
4. 验证可以看到 testuser1 的推送
5. 验证无法删除 testuser1 的推送

---

## 🔧 配置信息

### Android网络配置
```kotlin
BASE_URL: "http://10.88.1.127:8883/api/"
WS_URL: "ws://10.88.1.127:8883/api/ws"
```

### 测试账号
| 用户名 | 密码 | 昵称 |
|--------|------|------|
| testuser1 | 123456 | 测试用户1 |
| testuser2 | 123456 | 测试用户2 |
| testuser3 | 123456 | 测试用户3 |

---

## 🐛 常见问题排查

### 问题1：Android无法连接后端

**症状**：登录失败、菜品列表为空

**排查步骤**：
1. 确认后端是否启动：
   - 浏览器访问 http://10.88.1.127:8883/api/
   - 应该看到响应或404（表示服务器在线）

2. 确认手机和电脑在同一WiFi：
   - 手机连接WiFi
   - 电脑连接同一WiFi
   - 查看电脑IP：`ipconfig`（Windows）

3. 确认BASE_URL配置：
   - 打开 `android-app/app/build.gradle.kts`
   - 查找 `BASE_URL`
   - 确认是 `10.88.1.127:8883`（你的实际IP）

4. 检查防火墙：
   - Windows防火墙是否允许8883端口
   - 添加入站规则：端口8883，协议TCP，允许连接

**解决方法**：
```bash
# 查看Windows防火墙规则
# 控制面板 → Windows Defender 防火墙 → 高级设置 → 入站规则 → 新建规则
```

---

### 问题2：数据库连接失败

**症状**：后端启动失败，日志显示数据库错误

**排查步骤**：
1. 确认MySQL服务运行：
   - 服务管理器中查找MySQL服务
   - 或命令：`net start MySQL`

2. 确认数据库存在：
   ```bash
   mysql -u root -p123456 -e "SHOW DATABASES LIKE 'what2eat';"
   ```

3. 确认后端配置：
   - 打开 `springboot-backend/src/main/resources/application.yml`
   - 确认数据库配置正确

**解决方法**：
```bash
# 重启MySQL服务
net stop MySQL
net start MySQL
```

---

### 问题3：中文显示乱码

**症状**：Android应用中显示乱码字符

**解决方法**：
1. 确认数据库字符集：`utf8mb4`
2. 重新初始化数据库：
   ```bash
   mysql -u root -p123456 < C:\claude-project\eatwhat\init_database.sql
   ```
3. 重启后端服务

---

## 📊 API接口测试

### 使用浏览器测试

1. **测试后端连接**：
   - 访问：http://10.88.1.127:8883/api/

2. **测试Swagger文档**：
   - 访问：http://10.88.1.127:8883/api/swagger-ui.html

3. **测试登录接口**：
   ```bash
   curl -X POST http://10.88.1.127:8883/api/auth/login \
     -H "Content-Type: application/json" \
     -d "{\"username\":\"testuser1\",\"password\":\"123456\"}"
   ```

4. **测试获取菜品接口**（需要token）：
   ```bash
   curl -X GET http://10.88.1.127:8883/api/dishes \
     -H "Authorization: Bearer YOUR_TOKEN"
   ```

---

## 📱 日志查看

### Android日志
```bash
# 实时查看Android日志
adb logcat | findstr "What2Eat"

# 只看错误
adb logcat *:E | findstr "What2Eat"
```

### 后端日志
- 在IDEA的Run窗口查看
- 查找ERROR级别的日志
- 查找SQL语句（hibernate.show-sql=true）

---

## ✅ 测试完成标准

当以下所有功能都正常时，集成测试成功：

- [ ] 登录功能正常
- [ ] 菜品列表显示正常
- [ ] 分类切换正常
- [ ] 添加菜品到购物车正常
- [ ] 购物车展开/收起正常
- [ ] 推送菜单成功
- [ ] 推送列表显示正常
- [ ] 删除推送正常
- [ ] 中文显示正常
- [ ] 图片加载正常

---

## 🎉 下一步

测试通过后，可以：
1. 实现P1功能：二维码、扫码、上传菜品
2. 优化UI：动画、交互
3. 添加功能：好友系统、实时推送
4. 性能优化：缓存、图片压缩

**祝测试顺利！** 🎉
